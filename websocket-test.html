<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        #status { font-size: 20px; margin: 20px 0; }
        #messages { margin-top: 20px; }
        .log { margin: 5px 0; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>ì‘ê¸‰ì‹¤ WebSocket Test</h1>
    <div id="status">â³ ì—°ê²° ì¤‘...</div>
    <div id="messages"></div>

    <script>
        const ws = new WebSocket('ws://localhost:8080/emergency-websocket');
        const messagesDiv = document.getElementById('messages');

        function addLog(message) {
            const log = document.createElement('div');
            log.className = 'log';
            log.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            messagesDiv.appendChild(log);
        }

        ws.onopen = () => {
            document.getElementById('status').innerHTML = 'âœ… WebSocket ì—°ê²° ì„±ê³µ';
            addLog('WebSocket ì—°ê²° ì„±ê³µ');
            console.log('WebSocket ì—°ê²° ì„±ê³µ');
        };

        ws.onmessage = (event) => {
            console.log('ğŸ“© ë°›ì€ ì›ë³¸ ë°ì´í„°:', event.data);
            try {
                const data = JSON.parse(event.data);
                console.log('ğŸ“Š íŒŒì‹±ëœ ë°ì´í„°:', data);
                const count = Array.isArray(data) ? data.length : 'ë°°ì—´ ì•„ë‹˜';
                console.log('ğŸ“ˆ ë°ì´í„° ê°œìˆ˜:', count);

                addLog(`âœ… ë°ì´í„° ìˆ˜ì‹  - ${count}ê±´`);

                if (Array.isArray(data) && data.length > 0) {
                    console.log('ì²« ë²ˆì§¸ ë³‘ì›:', data[0]);
                }
            } catch (e) {
                console.error('íŒŒì‹± ì—ëŸ¬:', e);
                addLog(`âŒ íŒŒì‹± ì—ëŸ¬: ${e.message}`);
            }
        };

        ws.onerror = (error) => {
            document.getElementById('status').innerHTML = 'âŒ WebSocket ì—ëŸ¬';
            addLog('âŒ WebSocket ì—ëŸ¬ ë°œìƒ');
            console.error('WebSocket ì—ëŸ¬:', error);
        };

        ws.onclose = () => {
            document.getElementById('status').innerHTML = 'ğŸ”Œ WebSocket ì—°ê²° ì¢…ë£Œ';
            addLog('ğŸ”Œ WebSocket ì—°ê²° ì¢…ë£Œ');
        };
    </script>
</body>
</html>
